[EN](README.md) [RU](README_ru.md)

# Crypto Quest

Этот репозиторий содержит программный код "Оракул", ответственный за честное распределение игровых наград и демо-приложение, демонстрирующее его работу.

## Быстрый старт

Оракул и демо-приложение разработаны на node.js, ниже представленны шаги для развёртывания приложения на локальной машине:

1. Установить последнюю версию node.js: https://nodejs.org/en/download
2. Клонировать или скачать этот репозиторий
3. Открыть в терминале корневую папку скачанного репозитория
4. Запустить в терминале `npm install` для установки
5. Запустить в терминале `npm run dev` для запуска приложения
6. Открыть приложение по ссылке: http://localhost:3000

## Цели

### Прозрачность

Игроки должны:
- иметь возможность ознакомиться с исходным кодом механизма распределения наград
- иметь возможность ознакомиться со всеми наградами текущего и прошедших циклов
- иметь возможность найти блоки, которые они открывали, и удостовериться, что их действия действительно честно записаны в механизм

Разработчики не должны:
- менять сумму наград
- влиять на то, как награды рапределяются между игроками
- знать, где спрятаны призы

### Воспроизводимость результата

Вне зависимости от устройства, на котором запущен механизм, при одинаковой последовательности действий результат должен быть детерминирован и независим от внешнего влияния.
    
### Скрытность от разработчиков

Механизм должен препятствовать разработчикам знать, в каком блоке находятся призы, всё должно зависеть только от действий игроков. Таким образом, каждое следующее действие игрока должно случайным образом менять расположение наград, но при этом система должна быть воспроизводима при одинаковой последовательности действий.

### Гарантия наличия всех заданных наград

Механизм должен быть разработан таким образом, чтобы при открытии всех блоков все доступные награды должны быть выданы, и игроки должны иметь возможность это проверить.

### Демонстрация работы текущего цикла

Механизм должен иметь возможность демонстрировать работу текущего цикла, исключая возможность жульничества со стороны других игроков.

### Возможность изучения прошедших циклов

Механизм должен давать игрокам возможность увидеть свои действия и действия других игроков в честной симуляции и убедиться, что их награда была выдана честно.

## Оракул

Для реализации поставленных целей был разработан алгоритм Оракул, работающий по следующему сценарию:

1. Оракул инициализируется явно, и в него помещаются все доступные награды.
2. Инициализируется хеш с помощью стартового seed, который отвечает за случайность распределния наград.
3. Игрок нажимает на любой блок.
4. Механизм обновляет хеш, добавляя к нему `dig <block-index>` или `open <block-index>`, в зависимости от действия игрока.
5. Обновленный хеш отдается Оракулу для вычисления награды.
6. Вычисленная награда выдаётся игроку.
7. Возврат к пункту 3.

> [!IMPORTANT]
> Как видно из сценария, каждое действие игрока меняет хеш, на основании которого вычисляется следующая награда. Таким образом, на одном и том же Оракуле разная очередность вскрытия полей будет приводить к разному результату. 

### Внутреннее устройство

Программный код Оракула расположен внутри скачанного приложения в папке `libs/oracle/src`.

- Файл `libs/oracle/src/oracle-instance.js` содержит загруженные в Оракул призы.
- Файл `libs/oracle/src/oracle-utils.js` содержит функции изменения хеша и обращения к Оракулу для извлечения награды.
- Файл `libs/oracle/src/core/oracle.js` содержит реализацию Оракула.
- Файл `libs/oracle/src/core/seed.js` содержит механизм генерации хеша и случайных чисел на его основе.
- Папка `libs/oracle/src/test` содержит функции тестирования Оракула и механизма генерации случайных чисел, гарантирующий воспроизводимость результата и работоспособность Оракула.
- Папка `public/history` содержит историю открытия полей для текущего и прошлых циклов для проверки игроками честности алгоритмов.

> [!IMPORTANT]
> Важно отметить, что мы не загружаем в историю seed текущего цикла для предотвращения попыток жульничества.

## Демо-приложение

Демо-приложение дает возможность игрокам открыть симуляцию текущего цикла и убедиться, что все награды действительно существуют на поле, а также убедиться в честности и воспроизводимости результата.

Как один из способов проверки соответствия демо-приложения и реальной игры, рекомендуем сделать скриншот приглянувшегося поля и по завершению цикла сравнить результат в демо-приложениии со скриншотом, а также найти все открытые супер-призы и призы, которые не были открыты за выбранный цикл.

> [!IMPORTANT]
> Мы не раскрываем данные игроков, которые открывали блок, для сохранения анонимности пользователей.

### Внутреннее устройство

- Файл `src/controllers/field-controller.js` обеспечивает связь между демо-приложением и Оракулом, запоминая уже вскрытые поля и запрашивая новые награды, а также реализует механизм событий для UI.
- Папка `src/cycles` содержит все данные для инициализации Оракула для текущего и прошедших циклов.

## Команда Crypto Quest всегда открыта к предложениям и искренне желает вам удачи!
